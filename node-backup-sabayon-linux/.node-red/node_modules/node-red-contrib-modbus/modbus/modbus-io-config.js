"use strict";module.exports=function(i){require("source-map-support").install();var o=require("./core/modbus-io-core");i.nodes.registerType("modbus-io-config",function(e){var a=require("fs-extra");i.nodes.createNode(this,e),this.name=e.name,this.path=e.path,this.format=e.format,this.addressOffset=e.addressOffset;var n=this;n.setMaxListeners(0),n.lastUpdatedAt=null;var t=new o.LineByLineReader(n.path);o.internalDebug("Read IO File "+n.path),n.configData=[],t.on("error",function(e){o.internalDebug(e.message)}),t.on("line",function(e){e&&n.configData.push(JSON.parse(e))}),t.on("end",function(){n.lastUpdatedAt=Date.now(),o.internalDebug("Read IO Done From File "+n.path),n.warn({payload:o.allValueNamesFromIOFile(n),name:"Modbus Value Names From IO File",path:n.path}),n.emit("updatedConfig",n.configData)}),o.internalDebug("Loading IO File Started For "+n.path),n.watcher=a.watchFile(n.path,function(e,a){if(o.internalDebug("the current mtime is: "+e.mtime),o.internalDebug("the previous mtime was: "+a.mtime),e.mtime!==a.mtime){o.internalDebug("Reload IO File "+n.path),n.configData=[],delete n.lastUpdatedAt;var t=new o.LineByLineReader(n.path);t.on("error",function(e){o.internalDebug(e.message)}),t.on("line",function(e){e&&n.configData.push(JSON.parse(e))}),t.on("end",function(){n.lastUpdatedAt=Date.now(),o.internalDebug("Reload IO Done From File "+n.path),n.warn({payload:o.allValueNamesFromIOFile(n),name:"Modbus Value Names From IO File",path:n.path}),n.emit("updatedConfig",n.configData)}),o.internalDebug("Reloading IO File Started For "+n.path)}}),n.on("close",function(e){a.unwatchFile(n.path),n.watcher.close(),e()})})};
//# sourceMappingURL=maps/modbus-io-config.js.map
