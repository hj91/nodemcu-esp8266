<script type="text/javascript">
   RED.nodes.registerType( 'compactcom-40-rest-read', {
      category: 'Anybus',
      color: '#758597',
      defaults : {
         name : { value : "" },
         compactCom40Module : { value : "", type : "compactcom-40-module" },
         adiList : { value : "" }
      },
      inputs : 1,
      outputs : 1,
      icon : "anybus_white_cmyk.png",
      label : function() {
         return this.name || "compactcom 40 rest read";
      }
    } );
</script>

<script type="text/x-red" data-template-name="compactcom-40-rest-read">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-compactCom40Module"><i class="fa fa-tablet"></i> Device</label>
        <input type="text" id="node-input-compactCom40Module" placeholder="CompactCom 40 device">
    </div>
    <div class="form-row">
        <label for="node-input-adiList"><i class="fa fa-list"></i> ADI list</label>
        <input type="text" id="node-input-adiList" placeholder="1,2,3 or leave empty">
    </div>
</script>

<script type="text/x-red" data-help-name="compactcom-40-rest-read">
    <p>A node to read module identity and a set of application data instances from an
    Anybus CompactCom 40 enabled device.</p>
    <p>The IP address and the list of application data instances can be configured in the node.
    If they are left blank they should be set in an incoming message on <code>msg.ipAddress</code>
    and <code>msg.adiList</code>:</p>
    <ul>
       <li><code>ipAddress</code>: A string with an IP address, e.g. <code>"192.168.0.10"</code>.</li>
       <li><code>adiList</code>: A list of application data instance numbers, e.g. <code>[4,32,100,232]</code>. Leave blank to only get module identity.</li>
    </ul>
    <p>Configured values has priority over values in the incoming message.</p>
    <p>The IP address is configured in the node by adding an Anybus CompactCom 40 enabled device with a name and its IP address.
    By adding a device in the node it is also possible to configure authentication with a user name, a password and select one of the authentication types Basic or Digest.
    This device can be reused by multiple Anybus CompactCom 40 nodes in a flow.</p>
    <p>The list of application data instances is configured in the node by writing a
    comma separated list of application data instance numbers, e.g. 4,32,100,232.
    Only application data instances of instance class variable and array are supported properly.</p>
    <p>The output message contains the following properties:</p>
    <ul>
      <li><code>payload</code>: Holds an key/value object with device information and a list of the requsted application data instances.</li>
    </ul>
    <p>The key/value object in the <code>payload</code> has the following properties:</p>
    <ul>
       <li><code>name</code>: Product name of the device.</li>
       <li><code>ipAddress</code>: IP address of the device</li>
       <li><code>version</code>: Firmware version of the device</li>
       <li><code>serialNumber</code>: Serial number of the device</li>
       <li><code>dataFormat</code>: Data format of the values in the application data instances. <code>0</code> for little-endian and <code>1</code> for big-endian.</li>
       <li><code>numAdis</code>: Total number of application data instances in the device.</li>
       <li><code>adiList</code>: A key/value object with application data instances where the keys are the instance numbers and the value is another key/value object representing each application data instance.</li>
    </ul>
    <p>Each application data instance is represented by a key/value object with the following properties:</p>
    <ul>
       <li><code>name</code>: Name of the application data instance.</li>
       <li><code>numElements</code>: Number of elements in the instance.</li>
       <li><code>dataType</code>: Data type of the value</li>
       <li><code>minValue</code>: The minimum value the instance can be set to.</li>
       <li><code>maxValue</code>: The maximum value the instance can be set to.</li>
       <li><code>access</code>: Bitfield with access rights of the instance. Bit 0
          <ul>
             <li>Bit 0: 1 = Get access</li>
             <li>Bit 1: 1 = Set access</li>
          </ul>
       </li>
       <li><code>value</code>: The current value of the application data instance.</li>
    </ul>
    <p>If an error object is present in the key/value objects above, e.g <code>{ error: 2 }</code>,
    it presents an Anybus protocol error code.</p>
</script>
