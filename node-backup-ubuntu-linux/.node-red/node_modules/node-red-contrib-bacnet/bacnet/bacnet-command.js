"use strict";module.exports=function(a){var o=require("./core/bacnet-core"),u=require("@biancoroyal/bacstack"),p=require("underscore");a.nodes.registerType("BACnet-Command",function(e){a.nodes.createNode(this,e),this.name=e.name,this.commandType=e.commandType,this.timeDuration=e.timeDuration||0,this.enableDisable=e.enableDisable||u.enum.EnableDisable.ENABLE,this.deviceState=e.deviceState||u.enum.ReinitializedState.COLDSTART,this.isUtc=e.isUtc||!0,this.lowLimit=e.lowLimit||null,this.highLimit=e.highLimit||null,this.credentials=e.credentials,this.device=a.nodes.getNode(e.device),this.deviceIPAddress=this.device.deviceAddress||"127.0.0.1",this.connector=a.nodes.getNode(e.server);var n=this;n.status({fill:"green",shape:"dot",text:"active"}),n.on("input",function(t){n.connector||n.error(new Error("Client Not Ready To Read"),t),o.internalDebugLog("Command");var e=t.payload.commandType||n.commandType,a=t.payload.options||null;switch(a?t.payload.options.password||(t.payload.options.password=n.credentials.password):a={maxSegments:u.enum.MaxSegmentsAccepted.SEGMENTS_65,maxAdpu:u.enum.MaxApduLengthAccepted.OCTETS_1476,invokeId:null,password:n.credentials?n.credentials.password:null},e){case"deviceCommunicationControl":n.connector.client.deviceCommunicationControl(t.payload.deviceIPAddress||n.deviceIPAddress,t.payload.timeDuration||n.timeDuration,t.payload.enableDisable||n.enableDisable,a,function(e,a){if(e){var i=o.translateErrorMessage(e);o.internalDebugLog(i),n.error(i,t)}else o.internalDebugLog("value: ",a),t.input=t.payload,t.payload=a});break;case"reinitializeDevice":n.connector.client.reinitializeDevice(t.payload.deviceIPAddress||n.deviceIPAddress,t.payload.deviceState||n.deviceState,a,function(e,a){if(e){var i=o.translateErrorMessage(e);o.internalDebugLog(i),n.error(i,t)}else o.internalDebugLog("value: ",a),t.input=t.payload,t.payload=a});break;case"timeSync":t.payload.isUtc||n.isUtc?n.connector.client.timeSyncUTC(t.payload.deviceIPAddress||n.deviceIPAddress,t.payload.syncDateTime||new Date):n.connector.client.timeSync(t.payload.deviceIPAddress||n.deviceIPAddress,t.payload.syncDateTime||new Date);break;case"whoIsExplicit":n.connector.whoIsExplicit(t.payload.lowLimit||n.lowLimit,t.payload.highLimit||n.highLimit,t.payload.deviceIPAddress||n.deviceIPAddress,function(){t.input=t.payload,t.payload=n.connector.devices,n.send(t)});break;case"whoIs":n.connector.whoIs(function(){t.input=t.payload,t.payload=n.connector.devices,n.send(t)});break;default:o.internalDebugLog("Unknown Command Type Selected "+e)}t.devices=n.connector.devices,n.send(t)})}),a.httpAdmin.get("/bacnet/BacnetEnableDisable",a.auth.needsPermission("bacnet.CMD.read"),function(e,a){var i=u.enum.EnableDisable,t=p.toArray(p.invert(i)),n=[],o=void 0,r=!0,d=!1,s=void 0;try{for(var c,l=t[Symbol.iterator]();!(r=(c=l.next()).done);r=!0)o=c.value,n.push({typeValue:i[o],label:o})}catch(e){d=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(d)throw s}}a.json(n)}),a.httpAdmin.get("/bacnet/BacnetReinitializedStates",a.auth.needsPermission("bacnet.CMD.read"),function(e,a){var i=u.enum.ReinitializedState,t=p.toArray(p.invert(i)),n=[],o=void 0,r=!0,d=!1,s=void 0;try{for(var c,l=t[Symbol.iterator]();!(r=(c=l.next()).done);r=!0)o=c.value,n.push({typeValue:i[o],label:o})}catch(e){d=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(d)throw s}}a.json(n)})};
//# sourceMappingURL=maps/bacnet-command.js.map
