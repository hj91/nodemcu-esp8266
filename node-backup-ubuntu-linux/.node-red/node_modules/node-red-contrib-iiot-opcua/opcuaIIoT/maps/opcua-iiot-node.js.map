{"version":3,"sources":["opcua-iiot-node.js"],"names":["module","exports","RED","require","install","core","nodes","registerType","config","OPCUAIIoTNode","createNode","nodeId","this","datatype","value","topic","name","injectType","node","subscribed","fill","shape","text","msg","nodetype","on","status","addressSpaceItems","valuesToWrite","push","datatypeName","convertDataValueByDataType","payload","err","internalDebugLog","showErrors","error","JSON","stringify","send"],"mappings":"AAQA,aAOAA,OAAOC,QAAU,SAAUC,GACzBC,QAAQ,sBAAsBC,UAC9B,IAAIC,EAAOF,QAAQ,0BAqCcD,EAAAI,MAA3BC,aAAA,kBAnCN,SAAwBC,GAAxBN,EAAAI,MAASG,WAAeD,KAAxBA,GACEN,KAAII,OAAMI,EAAWC,OACrBC,KAAKD,SAASH,EAAOG,SACrBC,KAAKC,MAALL,EAAgBA,MAChBI,KAAKE,MAAQN,EAAOM,MACpBF,KAAKG,KAALP,EAAmBQ,KACnBJ,KAAKI,WAAaR,EAAlBS,WACAL,KAAKK,WAAaT,EAAOS,WAGzB,IAAIC,EAAON,KACXM,EAAKC,YAAa,EAELC,EAAAA,OAAM,CAAAA,KAAP,OAAAC,MAAA,OAAAC,KAAA,QAA8BA,EAAAA,GAAM,QAAA,SAAAC,GAWAD,GAXhDC,EAAAC,SAAA,OAEAN,EAAKO,WAAYF,EAAAN,YAAeC,EAAAD,WAC9BM,EAAIC,YAAWN,EAAfC,WAEwBA,WAApBD,EAACC,WAGCD,EAAKC,WADPD,EAAKD,OAAAA,CAAAA,KAAL,OAAoBI,MAAU,MAAAC,KAAA,eAE9BJ,EAAKQ,OAAO,CAAAN,KAAA,OAAAC,MAAA,OAAAC,KAAA,mBAA6BA,EAAAA,OAAM,CAAAF,KAAA,OAAAC,MAAA,MAAAC,KAAA,aAE/CJ,EAAAA,MAAKQ,EAAOX,OAAAG,EAAAH,MAACK,EAAAA,kBAADG,EAAAI,mBAAA,GAAoC,UAANL,EAAAA,WAAM,CAApCC,EAAZK,cAAAL,EAAAK,eAAA,GACDL,EAAAI,kBAAAE,KAAA,CAAAb,KAAAE,EAAAF,KAAAL,OAAAO,EAAAP,OAAAmB,aAAAZ,EAAAL,WAEDK,IAAaE,EAAIQ,cAALC,KAAAxB,EAAA0B,2BAAA,CAAAjB,MAAAS,EAAAS,SAAAd,EAAAJ,OAAAI,EAAAL,WAAeQ,MAAOY,GAAOX,EAAIY,iBAAED,GAA/Cf,EAAAiB,YACDjB,EAAAkB,MAAAH,EAAAV,SAkBCA,EAAII,kBAAkBE,KAAK,CAACb,KAAME,EAAKF,KAAML,OAAQO,EAAKP,OAAQmB,aAAcZ,EAAKL,WAGvFR,EAAK6B,iBAAiB,yBAA2BG,KAAKC,UAAUf,IAd9DA,EAAGgB,KAACZ","file":"../opcua-iiot-node.js","sourcesContent":["/*\n The BSD 3-Clause License\n\n Copyright 2016,2017,2018 - Klaus Landsdorf (http://bianco-royal.de/)\n Copyright 2015,2016 - Mika Karaila, Valmet Automation Inc. (node-red-contrib-opcua)\n All rights reserved.\n node-red-contrib-iiot-opcua\n */\n'use strict'\n\n/**\n * OPC UA node representation for Node-RED OPC UA IIoT nodes.\n *\n * @param RED\n */\nmodule.exports = function (RED) {\n  require('source-map-support').install()\n  let core = require('./core/opcua-iiot-core')\n\n  function OPCUAIIoTNode (config) {\n    RED.nodes.createNode(this, config)\n    this.nodeId = config.nodeId\n    this.datatype = config.datatype\n    this.value = config.value\n    this.topic = config.topic\n    this.name = config.name\n    this.injectType = config.injectType\n    this.showErrors = config.showErrors\n\n    let node = this\n    node.subscribed = false\n\n    node.status({fill: 'blue', shape: 'ring', text: 'new'})\n\n    node.on('input', function (msg) {\n      msg.nodetype = 'node'\n      msg.injectType = msg.injectType || node.injectType\n      node.subscribed = !node.subscribed\n\n      if (node.injectType === 'listen') {\n        if (node.subscribed) {\n          node.status({fill: 'blue', shape: 'dot', text: 'subscribed'})\n        } else {\n          node.status({fill: 'blue', shape: 'ring', text: 'not subscribed'})\n        }\n      } else {\n        node.status({fill: 'blue', shape: 'dot', text: 'injected'})\n      }\n\n      msg.topic = msg.topic || node.topic\n      msg.addressSpaceItems = msg.addressSpaceItems || [] // eslint-disable-line\n\n      if (node.injectType === 'write') {\n        msg.valuesToWrite = msg.valuesToWrite || [] // eslint-disable-line\n        msg.addressSpaceItems.push({name: node.name, nodeId: node.nodeId, datatypeName: node.datatype})\n\n        try {\n          msg.valuesToWrite.push(core.convertDataValueByDataType({value: msg.payload || node.value}, node.datatype))\n        } catch (err) {\n          core.internalDebugLog(err)\n          if (node.showErrors) {\n            node.error(err, msg)\n          }\n        }\n      } else {\n        msg.addressSpaceItems.push({name: node.name, nodeId: node.nodeId, datatypeName: node.datatype})\n      }\n\n      core.internalDebugLog('node msg stringified: ' + JSON.stringify(msg))\n      node.send(msg)\n    })\n  }\n\n  RED.nodes.registerType('OPCUA-IIoT-Node', OPCUAIIoTNode)\n}\n"]}