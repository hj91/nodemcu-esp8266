"use strict";module.exports=function(r){require("source-map-support").install();var f=require("./core/opcua-iiot-core-connector"),a=require("path"),m=require("underscore"),c=require("better-assert");try{r.nodes.registerType("OPCUA-IIoT-Connector",function(e){r.nodes.createNode(this,e),this.discoveryUrl=e.discoveryUrl||null,this.endpoint=e.endpoint,this.endpointMustExist=e.endpointMustExist||!1,this.keepSessionAlive=e.keepSessionAlive,this.loginEnabled=e.loginEnabled,this.name=e.name,this.showErrors=e.showErrors,this.securityPolicy=e.securityPolicy,this.messageSecurityMode=e.securityMode,this.publicCertificateFile=e.publicCertificateFile,this.privateKeyFile=e.privateKeyFile,this.defaultSecureTokenLifetime=e.defaultSecureTokenLifetime||12e4,this.autoSelectRightEndpoint=e.autoSelectRightEndpoint,this.strategyMaxRetry=e.strategyMaxRetry||1e4,this.strategyInitialDelay=e.strategyInitialDelay||500,this.strategyMaxDelay=e.strategyMaxDelay||3e4,this.strategyRandomisationFactor=e.strategyRandomisationFactor||.2,this.requestedSessionTimeout=e.requestedSessionTimeout||6e4,this.connectionStartDelay=e.connectionStartDelay||2e3,this.reconnectDelay=e.reconnectDelay||1e3,this.connectionStopDelay=e.connectionStopDelay||2e3,this.maxBadSessionRequests=e.maxBadSessionRequests||10;var o=this;o.setMaxListeners(0),o.client=null,o.sessionNodeRequests=0,o.endpoints=[],o.userIdentity=null,o.opcuaClient=null,o.opcuaSession=null,o.discoveryServer=null,o.serverCertificate=null,o.discoveryServerEndpointUrl=null,o.createConnectionTimeout=null,o.hasOpcUaSubscriptions=!1,f.internalDebugLog("Open Connector Node"),o.stateMachine=f.createStatelyMachine(),f.internalDebugLog("Start FSM: "+o.stateMachine.getMachineState()),f.detailDebugLog("FSM events:"+o.stateMachine.getMachineEvents());var t=null,i=null,n=null,s=f.core.getNodeOPCUAClientPath();o.securedCommunication=o.securityPolicy&&"None"!==o.securityPolicy&&o.messageSecurityMode&&"NONE"!==o.messageSecurityMode,f.detailDebugLog("config: "+o.publicCertificateFile),f.detailDebugLog("config: "+o.privateKeyFile),f.detailDebugLog("securedCommunication: "+o.securedCommunication.toString()),o.initCertificatesAndKeys=function(){o.securedCommunication?(null!==o.publicCertificateFile&&""!==o.publicCertificateFile||(o.publicCertificateFile=a.join(s,"/certificates/client_selfsigned_cert_1024.pem"),f.detailDebugLog("default key: "+o.publicCertificateFile)),null!==o.privateKeyFile&&""!==o.privateKeyFile||(o.privateKeyFile=a.join(s,"/certificates/PKI/own/private/private_key.pem"),f.detailDebugLog("default key: "+o.privateKeyFile))):(o.publicCertificateFile=null,o.privateKeyFile=null)},o.loginEnabled&&(o.credentials?(o.userIdentity={userName:o.credentials.user,password:o.credentials.password},f.internalDebugLog("Connecting With Login Data On "+o.endpoint)):o.error(new Error("Login Enabled But No Credentials"),{payload:""})),o.updateServerOptions=function(){o.initCertificatesAndKeys(),o.opcuaClientOptions={securityPolicy:o.securityPolicy||"None",securityMode:o.messageSecurityMode||"NONE",defaultSecureTokenLifetime:o.defaultSecureTokenLifetime||12e4,keepSessionAlive:o.keepSessionAlive,certificateFile:o.publicCertificateFile,privateKeyFile:o.privateKeyFile,endpoint_must_exist:o.endpointMustExist,requestedSessionTimeout:o.requestedSessionTimeout||6e4,connectionStrategy:{maxRetry:o.strategyMaxRetry||2e3,initialDelay:o.strategyInitialDelay||1e3,maxDelay:o.strategyMaxDelay||3e4,randomisationFactor:o.strategyRandomisationFactor||.2}}},o.connectOPCUAEndpoint=function(){f.checkEndpoint(o)&&(f.internalDebugLog("Connecting To Endpoint "+o.endpoint),o.updateServerOptions(),f.detailDebugLog("Options "+JSON.stringify(o.opcuaClientOptions)),o.opcuaClient=new f.core.nodeOPCUA.OPCUAClient(o.opcuaClientOptions),o.autoSelectRightEndpoint&&o.autoSelectEndpointFromConnection(),f.setListenerToClient(o.opcuaClient,o),o.connectToClient())},o.connectToClient=function(){f.checkEndpoint(o)&&(o.stateMachine.unlock(),o.opcuaClient.connect(o.endpoint,function(e){e?(o.stateMachine.lock().stopopcua(),o.handleError(e)):(f.internalDebugLog("Client Is Connected To "+o.endpoint),o.stateMachine.open())}))},o.renewConnection=function(e){o.opcuaDirectDisconnect(function(){o.renewFiniteStateMachine(),o.stateMachine.idle().initopcua(),e()})},o.endpointMatchForConnecting=function(e){f.internalDebugLog("Auto Endpoint "+e.endpointUrl.toString()+" "+e.securityPolicyUri.toString());var t=e.securityMode.key||e.securityMode,n=e.securityPolicyUri.includes("SecurityPolicy#")?e.securityPolicyUri.split("#")[1]:e.securityPolicyUri;return f.internalDebugLog("node-mode:"+o.messageSecurityMode+" securityMode: "+t),f.internalDebugLog("node-policy:"+o.securityPolicy+" securityPolicy: "+n),t===o.messageSecurityMode&&n===o.securityPolicy},o.selectEndpointFromSettings=function(n){n.getEndpoints(function(e,t){e?(f.internalDebugLog("Auto Switch To Endpoint Error "+e),o.showErrors&&o.error(e,{payload:"Get Endpoints Request Error"})):t.forEach(function(e){o.endpointMatchForConnecting(e)&&(o.endpoint=e.endpointUrl,f.internalDebugLog("Auto Switch To Endpoint "+o.endpoint))}),n.disconnect(function(e){e?(f.internalDebugLog("Endpoints Auto Request Error "+e),o.showErrors&&o.error(e,{payload:"Discover Client Disconnect Error"})):f.internalDebugLog("Endpoints Auto Request Done With Endpoint "+o.endpoint)})})},o.autoSelectEndpointFromConnection=function(){f.internalDebugLog("Auto Searching For Endpoint On "+o.endpoint);var t=o.opcuaClientOptions.endpoint_must_exist;o.opcuaClientOptions.endpoint_must_exist=!1;var e=new f.core.nodeOPCUA.OPCUAClient(o.opcuaClientOptions);e.connect(o.endpoint).then(function(){f.internalDebugLog("Auto Searching Endpoint Connected To "+o.endpoint),o.selectEndpointFromSettings(e),o.opcuaClientOptions.endpoint_must_exist=t}).catch(function(e){f.internalDebugLog("Get Auto Endpoint Request Error "+e.message),o.opcuaClientOptions.endpoint_must_exist=t})},o.startSession=function(t){return f.internalDebugLog("Request For New Session From "+t),o.isInactiveOnOPCUA()?(f.internalDebugLog("State Is Not Active While Start Session-> "+o.stateMachine.getMachineState()),void(o.showErrors&&o.error(new Error("OPC UA Connector Is Not Active"),{payload:"Create Session Error"}))):"OPEN"!==o.stateMachine.getMachineState()?(f.internalDebugLog("Session Request Not Allowed On State "+o.stateMachine.getMachineState()),void(o.showErrors&&o.error(new Error("OPC UA Connector Is Not Open"),{payload:"Create Session Error"}))):o.opcuaClient?(o.stateMachine.sessionrequest(),void o.opcuaClient.createSession(o.userIdentity||{}).then(function(e){o.opcuaSession=e,o.stateMachine.sessionactive(),f.detailDebugLog("Session Created On "+o.endpoint+" For "+t),f.logSessionInformation(o),o.opcuaSession.on("session_closed",function(e){o.handleSessionClose(e)})}).catch(function(e){o.stateMachine.lock().stopopcua(),o.emit("session_error",e),o.handleError(e)})):(f.internalDebugLog("OPC UA Client Connection Is Not Valid On State "+o.stateMachine.getMachineState()),void(o.showErrors&&o.error(new Error("OPC UA Client Connection Is Not Valid"),{payload:"Create Session Error"})))},o.resetBadSession=function(){o.sessionNodeRequests+=1,f.detailDebugLog("Session Node Requests At Connector No.: "+o.sessionNodeRequests),o.showErrors&&f.internalDebugLog("!!!!!!!!!!!!!!!!!!!!!   BAD SESSION ON CONNECTOR   !!!!!!!!!!!!!!!!!!".bgWhite.red),o.sessionNodeRequests>o.maxBadSessionRequests&&(f.internalDebugLog("Reset Bad Session Request On State "+o.stateMachine.getMachineState()),o.resetOPCUAConnection("ToManyBadSessionRequests"))},o.isInactiveOnOPCUA=function(){var e=o.stateMachine.getMachineState();return"STOPPED"===e||"END"===e||"RENEW"===e||"RECONFIGURED"===e},o.resetOPCUAConnection=function(e){f.detailDebugLog(e+" Request For New OPC UA Connection"),o.isInactiveOnOPCUA()||(o.stateMachine.lock().renew(),o.emit("reset_opcua_connection"),o.closeSession(function(){o.renewConnection(function(){f.detailDebugLog("OPC UA Connection Reset Done")})}))},o.closeSession=function(t){if(o.opcuaClient&&o.opcuaSession){f.detailDebugLog("Close Session And Remove Subscriptions From Session On State "+o.stateMachine.getMachineState());try{o.opcuaClient.closeSession(o.opcuaSession,o.hasOpcUaSubscriptions,function(e){e&&o.handleError(e),t()})}catch(e){o.handleError(e),t()}finally{o.opcuaSession=null}}else f.internalDebugLog("Close Session Without Session On State "+o.stateMachine.getMachineState()),t()},o.handleError=function(e){f.internalDebugLog("Handle Error On "+o.endpoint+" err:"+e),o.showErrors&&o.error(e,{payload:"Handle Connector Error"})},o.handleSessionClose=function(e){f.internalDebugLog("Session Closed With StatusCode "+e),o.isInactiveOnOPCUA()?f.detailDebugLog("Connector Is Not Active On OPC UA While Session Close Event"):(f.logSessionInformation(o),"SESSIONRESTART"!==o.stateMachine.getMachineState()&&o.stateMachine.lock().sessionclose())},o.disconnectNodeOPCUA=function(t){if(f.internalDebugLog("OPC UA Disconnect Connector On State "+o.stateMachine.getMachineState()),o.opcuaClient){f.internalDebugLog("Close Node Disconnect Connector From "+o.endpoint);try{o.opcuaClient.disconnect(function(e){e&&o.handleError(e),f.internalDebugLog("Close Node Done For Connector On "+o.endpoint),t()})}catch(e){o.handleError(e),t()}finally{o.opcuaClient=null}}else f.internalDebugLog("Close Node Done For Connector Without Client On "+o.endpoint),t()},o.on("close",function(e){o.isInactiveOnOPCUA()?(f.detailDebugLog("OPC UA Client Is Not Active On Close Node"),e()):(f.detailDebugLog("OPC UA Client Is Active On Close Node With State "+o.stateMachine.getMachineState()),"SESSIONACTIVE"===o.stateMachine.getMachineState()?o.closeConnector(e):(f.internalDebugLog(o.stateMachine.getMachineState()+" -> !!!  CHECK CONNECTOR STATE ON CLOSE  !!!".bgWhite.red),e()))}),o.opcuaDisconnect=function(e){0<o.registeredNodeList.length?(f.internalDebugLog("Connector Has Registered Nodes And Can Not Close The Node -> Count: "+o.registeredNodeList.length),n&&(clearTimeout(n),n=null),n=setTimeout(function(){o.closeConnector(e)},o.connectionStopDelay)):o.opcuaDirectDisconnect(e)},o.opcuaDirectDisconnect=function(t){f.detailDebugLog("OPC UA Disconnect From Connector "+o.stateMachine.getMachineState()),o.disconnectNodeOPCUA(function(){o.stateMachine.lock().close();var e=o.stateMachine.getMachineState();f.detailDebugLog("Disconnected On State "+e),o.isInactiveOnOPCUA()||"CLOSED"===e||(console.log(e),t(),c(!1)),t()})},o.closeConnector=function(e){if(f.detailDebugLog("Close Connector "+o.stateMachine.getMachineState()),o.isInactiveOnOPCUA())return f.detailDebugLog("OPC UA Client Is Not Active On Close Connector"),void e();o.opcuaClient?o.opcuaDisconnect(e):(f.detailDebugLog("OPC UA Client Is Not Valid On Close Connector"),e())},o.restartWithNewSettings=function(e,t){f.internalDebugLog("Renew With Flex Connector Request On State "+o.stateMachine.getMachineState()),o.stateMachine.lock().reconfigure(),o.setNewParameters(e),o.initCertificatesAndKeys(),o.renewConnection(t)},o.setNewParameters=function(e){o.discoveryUrl=e.discoveryUrl||o.discoveryUrl,o.endpoint=e.endpoint||o.endpoint,o.keepSessionAlive=e.keepSessionAlive||o.keepSessionAlive,o.securityPolicy=e.securityPolicy||o.securityPolicy,o.messageSecurityMode=e.securityMode||o.messageSecurityMode,o.name=e.name||o.name,o.showErrors=e.showErrors||o.showErrors,o.publicCertificateFile=e.publicCertificateFile||o.publicCertificateFile,o.privateKeyFile=e.privateKeyFile||o.privateKeyFile,o.defaultSecureTokenLifetime=e.defaultSecureTokenLifetime||o.defaultSecureTokenLifetime,o.endpointMustExist=e.endpointMustExist||o.endpointMustExist,o.autoSelectRightEndpoint=e.autoSelectRightEndpoint||o.autoSelectRightEndpoint,o.strategyMaxRetry=e.strategyMaxRetry||o.strategyMaxRetry,o.strategyInitialDelay=e.strategyInitialDelay||o.strategyInitialDelay,o.strategyMaxDelay=e.strategyMaxDelay||o.strategyMaxDelay,o.strategyRandomisationFactor=e.strategyRandomisationFactor||o.strategyRandomisationFactor,o.requestedSessionTimeout=e.requestedSessionTimeout||o.requestedSessionTimeout,o.connectionStartDelay=e.connectionStartDelay||o.connectionStartDelay,o.reconnectDelay=e.reconnectDelay||o.reconnectDelay},o.resetOPCUAObjects=function(){f.detailDebugLog("Reset All OPC UA Objects"),o.sessionNodeRequests=0,o.opcuaClient=null,o.opcuaSession=null},o.subscribeFSMEvents=function(e){e.onIDLE=function(e,t,n){f.detailDebugLog("Connector IDLE Event FSM"),o.resetOPCUAObjects()},e.onINITOPCUA=function(e,t,n){f.detailDebugLog("Connector Init OPC UA Event FSM"),o.resetOPCUAObjects(),o.resetAllTimer(),o.emit("connector_init"),o.initCertificatesAndKeys(),i&&(clearTimeout(i),i=null),f.detailDebugLog("connecting OPC UA with delay of msec: "+o.connectionStartDelay),i=setTimeout(function(){try{o.connectOPCUAEndpoint()}catch(e){o.handleError(e),o.resetOPCUAObjects(),o.stateMachine.lock().stopopcua()}},o.connectionStartDelay)},e.onOPEN=function(e,t,n){f.detailDebugLog("Connector Open Event FSM"),o.emit("connection_started",o.opcuaClient),f.internalDebugLog("Client Connected To "+o.endpoint),f.detailDebugLog("Client Options "+JSON.stringify(o.opcuaClientOptions)),o.startSession("Open Event")},e.onSESSIONREQUESTED=function(e,t,n){f.detailDebugLog("Connector Session Request Event FSM")},e.onSESSIONACTIVE=function(e,t,n){f.detailDebugLog("Connector Session Active Event FSM"),o.sessionNodeRequests=0,o.emit("session_started",o.opcuaSession)},e.onSESSIONCLOSED=function(e,t,n){f.detailDebugLog("Connector Session Close Event FSM"),o.emit("session_closed"),o.opcuaSession=null},e.onSESSIONRESTART=function(e,t,n){f.detailDebugLog("Connector Session Restart Event FSM"),o.emit("session_restart")},e.onCLOSED=function(e,t,n){f.detailDebugLog("Connector Client Close Event FSM"),o.emit("connection_closed"),o.opcuaClient=null},e.onLOCKED=function(e,t,n){f.detailDebugLog("Connector Lock Event FSM")},e.onUNLOCKED=function(e,t,n){f.detailDebugLog("Connector Unlock Event FSM")},e.onSTOPPED=function(e,t,n){f.detailDebugLog("Connector Stopped Event FSM"),o.resetAllTimer(),o.emit("connection_stopped")},e.onEND=function(e,t,n){f.detailDebugLog("Connector End Event FSM"),o.resetAllTimer(),o.emit("connection_end")},e.onRECONFIGURED=function(e,t,n){f.detailDebugLog("Connector Reconfigure Event FSM"),o.resetAllTimer(),o.emit("connection_reconfigure")},e.onRENEW=function(e,t,n){f.detailDebugLog("Connector Renew Event FSM"),o.resetAllTimer(),o.emit("connection_renew")}},o.resetAllTimer=function(){f.detailDebugLog("Reset All Timer"),i&&(clearTimeout(i),i=null),t&&(clearTimeout(t),t=null),n&&(clearTimeout(n),n=null)},o.registeredNodeList={},o.renewFiniteStateMachine=function(){o.stateMachine=null,o.stateMachine=f.createStatelyMachine(),c("IDLE"===o.stateMachine.getMachineState()),o.subscribeFSMEvents(o.stateMachine)},o.registerForOPCUA=function(e){e?(f.internalDebugLog("Register In Connector NodeId: "+e.id),(o.registeredNodeList[e.id]=e).on("opcua_client_not_ready",function(){o.resetBadSession()}),1===Object.keys(o.registeredNodeList).length&&(f.internalDebugLog("Start Connector OPC UA Connection"),o.renewFiniteStateMachine(),o.stateMachine.idle().initopcua())):f.internalDebugLog("Node Not Valid To Register In Connector")},o.deregisterForOPCUA=function(e,t){if(!e)return f.internalDebugLog("Node Not Valid To Deregister In Connector"),void t();if(f.internalDebugLog("Deregister In Connector NodeId: "+e.id),delete o.registeredNodeList[e.id],"STOPPED"!==o.stateMachine.getMachineState()&&"END"!==o.stateMachine.getMachineState())if(0===Object.keys(o.registeredNodeList).length)if(o.stateMachine.lock().stopopcua(),o.opcuaClient){f.detailDebugLog("OPC UA Direct Disconnect On Unregister Of All Nodes");try{o.opcuaClient.disconnect(function(e){e&&o.handleError(e),t()})}catch(e){o.handleError(e),t()}finally{o.opcuaClient=null}}else t();else t();else t()}},{credentials:{user:{type:"text"},password:{type:"password"}}})}catch(e){f.internalDebugLog(e.message)}r.httpAdmin.get("/opcuaIIoT/client/discover/:id/:discoveryUrl",r.auth.needsPermission("opcua.discovery"),function(e,o){var i=r.nodes.getNode(e.params.id),s=decodeURIComponent(e.params.discoveryUrl);(f.internalDebugLog("Get Discovery Request "+JSON.stringify(e.params)+" for "+s),i)?s&&!s.includes("opc.tcp://")?o.json([]):(0,f.core.nodeOPCUA.perform_findServersRequest)(s,function(e,t){if(e)f.internalDebugLog("Perform Find Servers Request "+e),i.showErrors&&i.error(e,{payload:""}),o.json([]);else{var n=[];t.forEach(function(e){e.discoveryUrls.forEach(function(e){e.toString()!==s&&n.push(e.toString())})}),o.json(n)}}):(f.internalDebugLog("Get Discovery Request None Node "+JSON.stringify(e.params)),o.json([]))}),r.httpAdmin.get("/opcuaIIoT/client/endpoints/:id/:endpointUrl",r.auth.needsPermission("opcua.endpoints"),function(e,n){var o=r.nodes.getNode(e.params.id),t=decodeURIComponent(e.params.endpointUrl);if(f.internalDebugLog("Get Endpoints Request "+JSON.stringify(e.params)+" for "+t),o)if(t&&!t.includes("opc.tcp://"))n.json([]);else{var i=o.opcuaClientOptions.endpoint_must_exist;o.opcuaClientOptions.endpoint_must_exist=!1;var s=new f.core.nodeOPCUA.OPCUAClient(o.opcuaClientOptions);s.connect(t).then(function(){f.internalDebugLog("Get Endpoints Connected For Request"),s.getEndpoints(function(e,t){e?(o.showErrors&&o.error(e,{payload:""}),f.internalDebugLog("Get Endpoints Request Error "+e),n.json([])):(f.internalDebugLog("Sending Endpoints For Request"),n.json(t)),s.disconnect(function(){f.internalDebugLog("Get Endpoints Request Disconnect")}),o.opcuaClientOptions.endpoint_must_exist=i})}).catch(function(e){o.opcuaClientOptions.endpoint_must_exist=i,f.internalDebugLog("Get Endpoints Request Error "+e.message),n.json([])})}else f.internalDebugLog("Get Endpoints Request None Node "+JSON.stringify(e.params)),n.json([])}),r.httpAdmin.get("/opcuaIIoT/plain/DataTypeIds",r.auth.needsPermission("opcuaIIoT.plain.datatypes"),function(e,t){t.json(m.toArray(m.invert(f.core.nodeOPCUA.DataTypeIds)))}),r.httpAdmin.get("/opcuaIIoT/plain/AttributeIds",r.auth.needsPermission("opcuaIIoT.plain.attributeids"),function(e,t){t.json(m.toArray(m.invert(f.core.nodeOPCUA.AttributeIds)))}),r.httpAdmin.get("/opcuaIIoT/plain/StatusCodes",r.auth.needsPermission("opcuaIIoT.plain.statuscodes"),function(e,t){t.json(m.toArray(m.invert(f.core.nodeOPCUA.StatusCodes)))}),r.httpAdmin.get("/opcuaIIoT/plain/ObjectTypeIds",r.auth.needsPermission("opcuaIIoT.plain.objecttypeids"),function(e,t){t.json(f.core.nodeOPCUA.ObjectTypeIds)}),r.httpAdmin.get("/opcuaIIoT/plain/VariableTypeIds",r.auth.needsPermission("opcuaIIoT.plain.variabletypeids"),function(e,t){t.json(f.core.nodeOPCUA.VariableTypeIds)}),r.httpAdmin.get("/opcuaIIoT/plain/ReferenceTypeIds",r.auth.needsPermission("opcuaIIoT.plain.referencetypeids"),function(e,t){t.json(f.core.nodeOPCUA.ReferenceTypeIds)}),r.httpAdmin.get("/opcuaIIoT/xmlsets/public",r.auth.needsPermission("opcuaIIoT.xmlsets"),function(e,t){var n=[];n.push(f.core.nodeOPCUA.di_nodeset_filename),n.push(f.core.nodeOPCUA.adi_nodeset_filename),n.push("public/vendor/opc-foundation/xml/Opc.ISA95.NodeSet2.xml"),n.push("public/vendor/opc-foundation/xml/Opc.Ua.Adi.NodeSet2.xml"),n.push("public/vendor/opc-foundation/xml/Opc.Ua.Di.NodeSet2.xml"),n.push("public/vendor/opc-foundation/xml/Opc.Ua.Gds.NodeSet2.xml"),n.push("public/vendor/harting/10_di.xml"),n.push("public/vendor/harting/20_autoid.xml"),n.push("public/vendor/harting/30_aim.xml"),t.json(n)}),r.httpAdmin.get("/opcuaIIoT/list/DataTypeIds",r.auth.needsPermission("opcuaIIoT.list.datatypeids"),function(e,t){var n,o=f.core.nodeOPCUA.DataTypeIds,i=m.toArray(m.invert(o)),s=[],r=!0,a=!1,c=void 0;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)n=l.value,s.push({nodeId:"i="+o[n],label:n})}catch(e){a=!0,c=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw c}}t.json(s)}),r.httpAdmin.get("/opcuaIIoT/list/EventTypeIds",r.auth.needsPermission("opcuaIIoT.list.eventtypeids"),function(e,t){var n,o=f.core.nodeOPCUA.ObjectTypeIds,i=m.invert(o),s=m.filter(i,function(e){return-1<e.indexOf("Event")}),r=[],a=!0,c=!1,l=void 0;try{for(var u,d=s[Symbol.iterator]();!(a=(u=d.next()).done);a=!0)n=u.value,r.push({nodeId:"i="+o[n],label:n})}catch(e){c=!0,l=e}finally{try{a||null==d.return||d.return()}finally{if(c)throw l}}t.json(r)}),r.httpAdmin.get("/opcuaIIoT/list/InstanceTypeIds",r.auth.needsPermission("opcuaIIoT.list.instancetypeids"),function(e,t){var n,o=f.core.nodeOPCUA.ObjectTypeIds,i=f.core.nodeOPCUA.VariableTypeIds,s=m.toArray(m.invert(o)),r=m.toArray(m.invert(i)),a=[],c=!0,l=!1,u=void 0;try{for(var d,p=s[Symbol.iterator]();!(c=(d=p.next()).done);c=!0)n=d.value,a.push({nodeId:"i="+o[n],label:n})}catch(e){l=!0,u=e}finally{try{c||null==p.return||p.return()}finally{if(l)throw u}}var g=!0,y=!1,C=void 0;try{for(var h,S=r[Symbol.iterator]();!(g=(h=S.next()).done);g=!0)n=h.value,a.push({nodeId:"i="+o[n],label:n})}catch(e){y=!0,C=e}finally{try{g||null==S.return||S.return()}finally{if(y)throw C}}t.json(a)}),r.httpAdmin.get("/opcuaIIoT/list/VariableTypeIds",r.auth.needsPermission("opcuaIIoT.list.variabletypeids"),function(e,t){var n,o=f.core.nodeOPCUA.VariableTypeIds,i=m.toArray(m.invert(o)),s=[],r=!0,a=!1,c=void 0;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)n=l.value,s.push({nodeId:"i="+o[n],label:n})}catch(e){a=!0,c=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw c}}t.json(s)}),r.httpAdmin.get("/opcuaIIoT/list/ReferenceTypeIds",r.auth.needsPermission("opcuaIIoT.list.referencetypeids"),function(e,t){var n,o=f.core.nodeOPCUA.ReferenceTypeIds,i=m.toArray(m.invert(o)),s=[],r=!0,a=!1,c=void 0;try{for(var l,u=i[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)n=l.value,s.push({nodeId:"i="+o[n],label:n})}catch(e){a=!0,c=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw c}}t.json(s)}),r.httpAdmin.get("/opcuaIIoT/list/FilterTypes",r.auth.needsPermission("opcuaIIoT.list.filterids"),function(e,t){var n=[];n.push({name:"dataType",label:"Data Type"}),n.push({name:"dataValue",label:"Data Value"}),n.push({name:"nodeClass",label:"Node Class"}),n.push({name:"typeDefinition",label:"Type Definition"}),n.push({name:"browseName",label:"Browse Name"}),n.push({name:"nodeId",label:"Node Id"}),t.json(n)})};
//# sourceMappingURL=maps/opcua-iiot-connector.js.map
