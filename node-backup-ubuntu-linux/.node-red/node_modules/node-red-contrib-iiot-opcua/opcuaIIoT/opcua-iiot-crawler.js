"use strict";module.exports=function(t){require("source-map-support").install();var o=require("./core/opcua-iiot-core-browser");t.nodes.registerType("OPCUA-IIoT-Crawler",function(e){t.nodes.createNode(this,e),this.name=e.name,this.justValue=e.justValue,this.singleResult=e.singleResult,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.activateUnsetFilter=e.activateUnsetFilter,this.activateFilters=e.activateFilters,this.negateFilter=e.negateFilter,this.filters=e.filters,this.delayPerMessage=e.delayPerMessage||.2,this.connector=t.nodes.getNode(e.connector);var r=o.initClientNode(this);r.filterCrawlerResults=function(e){var t=e||[],s=[];return r.activateFilters&&r.filters&&0<r.filters.length&&(t.forEach(function(e){r.itemIsNotToFilter(e)&&s.push(e)}),t=s),r.justValue&&t.forEach(function(e){e.references&&delete e.references}),t},r.itemIsNotToFilter=function(t){var s=o.core.checkItemForUnsetState(r,t);return s&&r.filters.forEach(function(e){s=o.core.checkCrawlerItemIsNotToFilter(r,t,e,s)}),r.negateFilter?!s:s},r.crawl=function(e,t){o.core.checkSessionNotValid(r.opcuaSession,"Crawler")||(o.internalDebugLog("Browse Topic To Call Crawler "+r.browseTopic),r.showStatusActivities&&o.core.setNodeStatusTo(r,"crawling"),o.crawl(e,r.browseTopic,t).then(function(e){o.internalDebugLog(e.rootNodeId+" Crawler Results "+e.crawlerResult.length),r.sendMessage(e.message,r.filterCrawlerResults(e.message,e.crawlerResult))}).catch(function(e){o.browseErrorHandling(r,e,t)}))},r.crawlForSingleResult=function(e,t){o.crawlAddressSpaceItems(e,t).then(function(e){o.internalDebugLog(e.rootNodeId+" Crawler Results "+e.crawlerResult.length),r.sendMessage(e.message,r.filterCrawlerResults(e.crawlerResult))}).catch(function(e){o.browseErrorHandling(r,e,t)})},r.crawlForResults=function(t,s){s.addressSpaceItems.map(function(e){o.crawl(t,e.nodeId).then(function(e){o.internalDebugLog(e.rootNodeId+" Crawler Results "+e.crawlerResult.length),r.sendMessage(e.message,r.filterCrawlerResults(e.crawlerResult))}).catch(function(e){o.browseErrorHandling(r,e,s)})})},r.crawlNodeList=function(e,t){r.showStatusActivities&&o.core.setNodeStatusTo(r,"crawling"),r.singleResult?r.crawlForSingleResult(e,t):r.crawlForResults(e,t)},r.sendMessage=function(e,t){var s=Object.assign({},e);s.nodetype="crawl",s.payload={crawlerResults:t},r.browseTopic&&""!==r.browseTopic&&(s.payload.browseTopic=r.browseTopic),r.justValue||(s.payload.crawlerResultsCount=t.length,r.connector&&(s.payload.endpoint=r.connector.endpoint),s.payload.session=r.opcuaSession.name||"none"),r.messageList.push(s),r.showStatusActivities&&o.core.setNodeStatusTo(r,"active"),setTimeout(function(){r.send(r.messageList.shift())},r.delayPerMessage*o.core.FAKTOR_SEC_TO_MSEC)},r.startCrawling=function(e){r.browseTopic&&""!==r.browseTopic?r.crawl(r.opcuaSession,e):(e.addressItemsToBrowse&&(e.addressSpaceItems=e.addressItemsToBrowse),e.addressSpaceItems&&e.addressSpaceItems.length?(o.internalDebugLog("Start Crawling On AddressSpace Items"),r.crawlNodeList(r.opcuaSession,e)):r.error(new Error("No AddressSpace Items Or Root To Crawl"),e))},r.on("input",function(e){o.core.checkConnectorState(r,e,"Crawler")&&(r.browseTopic=o.extractNodeIdFromTopic(e,r),r.startCrawling(e))}),o.core.registerToConnector(r),r.on("close",function(e){o.core.deregisterToConnector(r,e)})})};
//# sourceMappingURL=maps/opcua-iiot-crawler.js.map
