"use strict";module.exports=function(o){require("source-map-support").install();var n=require("./core/opcua-iiot-core-inject"),r=require("cron");function e(e){o.nodes.createNode(this,e),this.topic=e.topic,this.payload=e.payload,this.payloadType=e.payloadType,this.repeat=e.repeat,this.crontab=e.crontab,this.once=e.once,this.startDelay=parseFloat(e.startDelay)||10,this.name=e.name,this.injectType=e.injectType||"inject",this.addressSpaceItems=e.addressSpaceItems||[];var a=this;if(a.intervalId=null,a.cronjob=null,a.REPEAT_FACTOR=1e3,a.ONE_SECOND=1e3,a.INPUT_TIMEOUT_MILLISECONDS=1e3,a.repeaterSetup=function(){n.internalDebugLog("Repeat Is "+a.repeat),n.internalDebugLog("Crontab Is "+a.crontab),""!==a.repeat?(a.repeat=parseFloat(e.repeat)*a.REPEAT_FACTOR,0===a.repeat&&(a.repeat=a.ONE_SECOND),n.internalDebugLog("Repeat Interval Start With "+a.repeat+" msec."),a.intervalId&&clearInterval(a.intervalId),a.intervalId=setInterval(function(){a.emit("input",{})},a.repeat)):""!==a.crontab&&(a.cronjob=new r.CronJob(a.crontab,function(){a.emit("input",{})},null,!0))},a.on("input",function(t){try{switch(t.topic=a.topic,t.nodetype="inject",t.injectType=a.injectType,t.addressSpaceItems=[],Object.assign(t.addressSpaceItems,a.addressSpaceItems),a.payloadType){case"none":t.payload="";break;case"str":t.payload=a.payload.toString();break;case"num":t.payload=Number(a.payload);break;case"bool":t.payload=!0===a.payload||"true"===a.payload;break;case"json":t.payload=JSON.parse(a.payload);break;case"date":t.payload=Date.now();break;default:null===a.payloadType?""===a.payload?t.payload=Date.now():t.payload=a.payload:t.payload=o.util.evaluateNodeProperty(a.payload,a.payloadType,this,t)}a.send(t)}catch(e){o.settings.verbose&&a.error(e,t)}}),a.once){var t=parseInt(a.INPUT_TIMEOUT_MILLISECONDS*a.startDelay);n.internalDebugLog("injecting once at start delay timeout "+t+" msec."),a.onceTimeout=setTimeout(function(){n.internalDebugLog("injecting once at start"),a.emit("input",{}),a.repeaterSetup()},t)}else a.repeaterSetup()}o.nodes.registerType("OPCUA-IIoT-Inject",e),e.prototype.close=function(){var e=this;e.onceTimeout&&(clearTimeout(e.onceTimeout),e.onceTimeout=null),e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null),e.cronjob&&(e.cronjob.stop(),delete e.cronjob)},o.httpAdmin.post("/opcuaIIoT/inject/:id",o.auth.needsPermission("opcuaIIoT.inject.write"),function(e,t){var a=o.nodes.getNode(e.params.id);if(a)try{a.receive(),t.sendStatus(200)}catch(e){t.sendStatus(500),a.error(o._("opcuaiiotinject.failed",{error:e.toString()}))}else t.sendStatus(404)})};
//# sourceMappingURL=maps/opcua-iiot-inject.js.map
