"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}module.exports=function(f){require("source-map-support").install();var p=require("./core/opcua-iiot-core-method");f.nodes.registerType("OPCUA-IIoT-Method-Caller",function(e){f.nodes.createNode(this,e),this.objectId=e.objectId,this.methodId=e.methodId,this.methodType=e.methodType,this.value=e.value,this.justValue=e.justValue,this.name=e.name,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.inputArguments=e.inputArguments,this.connector=f.nodes.getNode(e.connector);var h=p.core.initClientNode(this);h.handleMethodError=function(e,t){p.internalDebugLog(e),h.showErrors&&h.error(e,t),h.connector&&p.core.isSessionBad(e)&&h.connector.resetBadSession()},h.handleMethodWarn=function(e){h.showErrors&&h.warn(e),p.internalDebugLog(e)},h.callMethodOnSession=function(e,t){p.core.checkSessionNotValid(e,"MethodCaller")||(t.methodId&&t.inputArguments?p.getArgumentDefinition(h.opcuaSession,t).then(function(e){p.detailDebugLog("Call Argument Definition Results: "+JSON.stringify(e)),h.callMethod(t,e)}).catch(h.handleMethodError):p.internalDebugLog(new Error("No Method Id And/Or Parameters")))},h.callMethod=function(c,d){p.callMethods(h.opcuaSession,c).then(function(e){p.detailDebugLog("Methods Call Results: "+JSON.stringify(e));var t=null,o=[],r=Object.assign({},e.msg);r.nodetype="method",r.methodType=e.msg.methodType;var n=!0,s=!1,i=void 0;try{for(var u,a=e.results[Symbol.iterator]();!(n=(u=a.next()).done);n=!0)t=u.value,o.push({statusCode:t.statusCode,outputArguments:t.outputArguments})}catch(e){s=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(s)throw i}}var l={};l=h.justValue?(r.inputArguments&&delete r.inputArguments,JSON.stringify(o,null,2)):JSON.stringify({results:e.results,definition:d},null,2);try{f.util.setMessageProperty(r,"payload",JSON.parse(l))}catch(e){h.showErrors&&(h.warn("JSON not to parse from string for dataValues type "+("undefined"==typeof readResult?"undefined":_typeof(readResult))),h.error(e,c)),r.payload=l,r.error=e.message}h.send(r)}).catch(function(e){p.internalDebugLog(e),h.showErrors&&h.error(e,c)})},h.on("input",function(e){if(p.core.checkConnectorState(h,e,"MethodCaller")){var t=p.buildCallMessage(h,e);p.invalidMessage(h,t)||h.callMethodOnSession(h.opcuaSession,t)}}),p.core.registerToConnector(h),h.on("close",function(e){p.core.deregisterToConnector(h,e)})})};
//# sourceMappingURL=maps/opcua-iiot-method-caller.js.map
