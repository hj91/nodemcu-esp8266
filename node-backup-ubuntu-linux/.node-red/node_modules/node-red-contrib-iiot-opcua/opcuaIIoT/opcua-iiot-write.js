"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}module.exports=function(n){require("source-map-support").install();var i=require("./core/opcua-iiot-core-client");n.nodes.registerType("OPCUA-IIoT-Write",function(e){n.nodes.createNode(this,e),this.name=e.name,this.justValue=e.justValue,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.connector=n.nodes.getNode(e.connector);var s=i.core.initClientNode(this);s.handleWriteError=function(e,t){i.writeDebugLog(e),s.showErrors&&s.error(e,t),s.connector&&i.core.isSessionBad(e)&&s.connector.resetBadSession()},s.writeToSession=function(e,t){if(!i.core.checkSessionNotValid(e,"Writer")){var r=Object.assign({},t),o=i.core.buildNodesToWrite(r);i.write(e,o,r).then(function(e){try{var t=s.buildResultMessage(e);s.send(t)}catch(e){s.handleWriteError(e,r)}}).catch(function(e){s.handleWriteError(e,r)})}},s.buildResultMessage=function(e){var t=Object.assign({},e.msg);t.nodetype="write",t.justValue=s.justValue;var r=s.extractDataValueString(t,e);return t=s.setMessageProperties(t,e,r)},s.extractDataValueString=function(e,t){var r={};return s.justValue?(r=JSON.stringify({statusCodes:t.statusCodes},null,2),e.valuesToWrite&&delete e.valuesToWrite):r=JSON.stringify(t,null,2),r},s.setMessageProperties=function(t,r,o){try{n.util.setMessageProperty(t,"payload",JSON.parse(o))}catch(e){i.writeDebugLog(e),s.showErrors&&(s.warn("JSON not to parse from string for write statusCodes type "+_typeof(r.statusCodes)),s.error(e,r.msg)),t.resultsConverted=o,t.error=e.message}return t},s.on("input",function(e){i.core.checkConnectorState(s,e,"Write")&&("write"===e.injectType?s.writeToSession(s.opcuaSession,e):(i.writeDebugLog("Wrong Inject Type "+e.injectType+"! The Type has to be write."),s.showErrors&&s.warn("Wrong Inject Type "+e.injectType+"! The msg.injectType has to be write.")))}),i.core.registerToConnector(s),s.on("close",function(e){i.core.deregisterToConnector(s,e)})})};
//# sourceMappingURL=maps/opcua-iiot-write.js.map
