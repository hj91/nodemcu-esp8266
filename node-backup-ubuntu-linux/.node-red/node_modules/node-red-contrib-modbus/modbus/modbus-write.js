"use strict";module.exports=function(s){require("source-map-support").install();var o=require("./modbus-basics"),i=require("./core/modbus-core"),r=require("debug")("contribModbus:write");s.nodes.registerType("modbus-write",function(e){s.nodes.createNode(this,e),this.name=e.name,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.unitid=e.unitid,this.dataType=e.dataType,this.adr=Number(e.adr),this.quantity=e.quantity;var t=this,a=s.nodes.getNode(e.server);a.registerForModbus(t),t.bufferMessageList=new Map,o.initModbusClientEvents(t,a),o.setNodeStatusTo("waiting",t),t.onModbusWriteDone=function(e,s){t.showStatusActivities&&o.setNodeStatusTo("write done",t),t.send(i.buildMessage(t.bufferMessageList,s.payload,e,s))},t.onModbusWriteError=function(e,s){r(e.message),t.showErrors&&t.error(e,s),o.setModbusError(t,a,e,i.getOriginalMessage(t.bufferMessageList,s))},t.on("input",function(e){o.invalidPayloadIn(e)||a.client&&(e.payload.hasOwnProperty("value")&&"string"==typeof e.payload.value&&("true"===e.payload.value||"false"===e.payload.value?e.payload.value="true"===e.payload.value:-1<e.payload.value.indexOf(",")&&(e.payload.value=JSON.parse(e.payload.value))),e.messageId=i.getObjectId(),t.bufferMessageList.set(e.messageId,e),e={payload:{value:e.payload.value||e.payload,unitid:t.unitid,fc:i.functionCodeModbusWrite(t.dataType),address:t.adr,quantity:t.quantity,messageId:e.messageId},_msgid:e._msgid},a.emit("writeModbus",e,t.onModbusWriteDone,t.onModbusWriteError),t.showStatusActivities&&o.setNodeStatusTo(a.statlyMachine.getMachineState(),t))}),t.on("close",function(e){o.setNodeStatusTo("closed",t),t.bufferMessageList.clear(),a.deregisterForModbus(t,e)})})};
//# sourceMappingURL=maps/modbus-write.js.map
