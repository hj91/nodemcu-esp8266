"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}require("source-map-support").install();var de=de||{biancoroyal:{opcua:{iiot:{core:{browser:{crawler:{}}}}}}};de.biancoroyal.opcua.iiot.core.browser.core=de.biancoroyal.opcua.iiot.core.browser.core||require("./opcua-iiot-core"),de.biancoroyal.opcua.iiot.core.browser.internalDebugLog=de.biancoroyal.opcua.iiot.core.browser.internalDebugLog||require("debug")("opcuaIIoT:browser"),de.biancoroyal.opcua.iiot.core.browser.detailDebugLog=de.biancoroyal.opcua.iiot.core.browser.detailDebugLog||require("debug")("opcuaIIoT:browser:details"),de.biancoroyal.opcua.iiot.core.browser.crawler.internalDebugLog=de.biancoroyal.opcua.iiot.core.browser.crawler.internalDebugLog||require("debug")("opcuaIIoT:browser:crawler"),de.biancoroyal.opcua.iiot.core.browser.crawler.detailDebugLog=de.biancoroyal.opcua.iiot.core.browser.crawler.detailDebugLog||require("debug")("opcuaIIoT:browser:crawler:details"),de.biancoroyal.opcua.iiot.core.browser.browse=function(o,t){var n=this;return new Promise(function(r,i){var e=[{nodeId:t,referenceTypeId:"Organizes",includeSubtypes:!0,browseDirection:n.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63},{nodeId:t,referenceTypeId:"Aggregates",includeSubtypes:!0,browseDirection:n.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63}];o.browse(e,function(e,o){e?i(e):r(o)})})},de.biancoroyal.opcua.iiot.core.browser.browseAddressSpaceItems=function(e,t){var n=this;return new Promise(function(r,i){var o=[];t.forEach(function(e){o.push({nodeId:e.nodeId,referenceTypeId:"Organizes",includeSubtypes:!0,browseDirection:n.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63}),o.push({nodeId:e.nodeId,referenceTypeId:"Aggregates",includeSubtypes:!0,browseDirection:n.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63})}),e.browse(o,function(e,o){e?i(e):r(o)})})},de.biancoroyal.opcua.iiot.core.browser.createCrawler=function(e){return this.core.assert(null!==e),new this.core.nodeOPCUA.NodeCrawler(e)},de.biancoroyal.opcua.iiot.core.browser.crawl=function(a,s,c){var d=this;return new Promise(function(o,r){if(s){var i=Object.assign({},c),e=d.createCrawler(a),t=[],n={onBrowse:function(e,o){t.push(o),d.core.nodeOPCUA.NodeCrawler.follow(e,o,this)}};e.crawl(s,n,function(e){e?r(e):o({rootNodeId:s,message:i,crawlerResult:t})})}else r(new Error("NodeId To Crawl Not Valid"))})},de.biancoroyal.opcua.iiot.core.browser.crawlAddressSpaceItems=function(o,s){var c=this;return new Promise(function(r,i){if(s.addressSpaceItems){var t=Object.assign({},s),e=c.createCrawler(o),n=[],a={onBrowse:function(e,o){o||c.internalDebugLog("Item Not To Crawl - Missing NodeId"),n.push(o),c.core.nodeOPCUA.NodeCrawler.follow(e,o,this)}};t.addressSpaceItems.forEach(function(o){o.nodeId?e.crawl(o.nodeId,a,function(e){e?i(e):r({rootNodeId:o.nodeId,message:t,crawlerResult:n})}):c.internalDebugLog("Item Not To Crawl - Missing NodeId")})}else i(new Error("AddressSpace Items Not Valid To Crawl"))})},de.biancoroyal.opcua.iiot.core.browser.browseToRoot=function(){return this.detailDebugLog("Browse To Root "+this.core.OBJECTS_ROOT),this.core.OBJECTS_ROOT},de.biancoroyal.opcua.iiot.core.browser.extractNodeIdFromTopic=function(e,o){var r=null;return"browse"===e.payload.actiontype&&(r=e.payload.root&&e.payload.root.nodeId?(this.internalDebugLog("Root Selected External "+e.payload.root),e.payload.root.nodeId):o.nodeId,this.detailDebugLog("Extracted NodeId "+r),r=r||this.browseToRoot()),r},de.biancoroyal.opcua.iiot.core.browser.transformToEntry=function(o){if(o)try{return o.toJSON()}catch(e){if(this.internalDebugLog(e),o.referenceTypeId)return{referenceTypeId:o.referenceTypeId.toString(),isForward:o.isForward,nodeId:o.nodeId.toString(),browseName:o.browseName.toString(),displayName:o.displayName.toString(),nodeClass:o.nodeClass.toString(),typeDefinition:o.typeDefinition.toString()}}else this.internalDebugLog("Empty Reference On Browse");return o},de.biancoroyal.opcua.iiot.core.browser.initClientNode=function(e){var o=this.core.initClientNode(e);return o.items=[],o.browseTopic=this.core.OBJECTS_ROOT,o.messageList=[],o},de.biancoroyal.opcua.iiot.core.browser.browseErrorHandling=function(e,o,r,i){var t=i.browserResults||[];o?(this.internalDebugLog(_typeof(e)+"Error "+o),e.showErrors&&e.error(o,r),this.core.isSessionBad(o)&&e.connector&&e.connector.resetBadSession()):(this.internalDebugLog(_typeof(e)+" Done With Error"),t.length&&this.detailDebugLog(t.length+"items in lists of browser results")),e.showStatusActivities&&this.core.setNodeStatusTo(e,"error")},module.exports=de.biancoroyal.opcua.iiot.core.browser;
//# sourceMappingURL=../maps/core/opcua-iiot-core-browser.js.map
