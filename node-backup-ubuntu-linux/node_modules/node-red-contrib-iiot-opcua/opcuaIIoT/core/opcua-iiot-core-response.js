"use strict";require("source-map-support").install();var de=de||{biancoroyal:{opcua:{iiot:{core:{response:{}}}}}};de.biancoroyal.opcua.iiot.core.response.core=de.biancoroyal.opcua.iiot.core.response.core||require("./opcua-iiot-core"),de.biancoroyal.opcua.iiot.core.response.internalDebugLog=de.biancoroyal.opcua.iiot.core.response.internalDebugLog||require("debug")("opcuaIIoT:response"),de.biancoroyal.opcua.iiot.core.response.detailDebugLog=de.biancoroyal.opcua.iiot.core.response.detailDebugLog||require("debug")("opcuaIIoT:response:details"),de.biancoroyal.opcua.iiot.core.response.EMPTY_LIST=0,de.biancoroyal.opcua.iiot.core.response.NONE=0,de.biancoroyal.opcua.iiot.core.response.analyzeBrowserResults=function(e,a){this.handlePayloadStatusCode(e,a)},de.biancoroyal.opcua.iiot.core.response.analyzeReadResults=function(e,a){this.handlePayloadStatusCode(e,a),"HistoryValue"===a.readtype&&a.payload.forEach(function(e){delete e.statusCode})},de.biancoroyal.opcua.iiot.core.response.analyzeListenerResults=function(e,a){switch(a.injectType){case"subscribe":this.analyzeSubscribeResultStatus(e,a);break;case"event":this.analyzeEventResultStatus(e,a)}},de.biancoroyal.opcua.iiot.core.response.analyzeMethodResults=function(e,a){switch(a.methodType){case"basic":case"complex":this.handlePayloadStatusCode(e,a)}},de.biancoroyal.opcua.iiot.core.response.setNodeStatus=function(e,a,o){var s="green";a&&3===a.length&&(a[2]>this.EMPTY_LIST&&(s="yellow"),a[1]>this.EMPTY_LIST&&(s="red")),e.status.text!==o&&e.status({fill:s,shape:"dot",text:o})},de.biancoroyal.opcua.iiot.core.response.analyzeWriteResults=function(e,a){var o=this.handlePayloadArrayOfStatusCodes(a);this.setNodeStatusInfo(e,a,o)},de.biancoroyal.opcua.iiot.core.response.analyzeSubscribeResultStatus=function(e,a){this.handlePayloadStatusCode(e,a)},de.biancoroyal.opcua.iiot.core.response.analyzeEventResultStatus=function(e,a){this.handlePayloadStatusCode(e,a)},de.biancoroyal.opcua.iiot.core.response.handlePayloadStatusCode=function(e,a){var o=[0,0,0];o=a.payload.length||a.payload.results||a.payload.statusCodes?this.handlePayloadArrayOfObjects(a):this.handlePayloadObject(a),this.setNodeStatusInfo(e,a,o)},de.biancoroyal.opcua.iiot.core.response.setNodeStatusInfo=function(e,a,o){a.entryStatus=o,a.entryStatusText="Good:"+o[0]+" Bad:"+o[1]+" Other:"+o[2],this.setNodeStatus(e,a.entryStatus,a.entryStatusText)},de.biancoroyal.opcua.iiot.core.response.handlePayloadArrayOfObjects=function(e){var a=null,o=[0,0,0],s=[];e.payload.results?s=e.payload.results:e.payload.statusCodes?s=e.payload.statusCodes:e.payload.length&&(s=e.payload);var t=!0,d=!1,r=void 0;try{for(var n,l=s[Symbol.iterator]();!(t=(n=l.next()).done);t=!0)if((a=n.value).statusCode&&a.statusCode.name)switch(a.statusCode.name){case"Good":o[0]+=1;break;case"Bad":o[1]+=1;break;default:a.statusCode.name.includes("Good")?o[0]+=1:a.statusCode.name.includes("Bad")?o[1]+=1:o[2]+=1}else o[2]+=1}catch(e){d=!0,r=e}finally{try{t||null==l.return||l.return()}finally{if(d)throw r}}return o},de.biancoroyal.opcua.iiot.core.response.handlePayloadObject=function(e){var a=[0,0,0];if((e.payload.results||e.payload.statusCodes)&&(a=this.handlePayloadArrayOfObjects(e)),e.payload&&e.payload.statusCode)if(e.payload.statusCode.name)switch(e.payload.statusCode.name){case"Good":a[0]+=1;break;case"Bad":a[1]+=1;break;default:e.payload.statusCode.name.includes("Good")?a[0]+=1:e.payload.statusCode.name.includes("Bad")?a[1]+=1:a[2]+=1}else a[2]+=1;else a[2]+=1;return a},de.biancoroyal.opcua.iiot.core.response.handlePayloadArrayOfStatusCodes=function(e){var a=null,o=[0,0,0];if(e.payload.statusCodes){var s=!0,t=!1,d=void 0;try{for(var r,n=e.payload.statusCodes[Symbol.iterator]();!(s=(r=n.next()).done);s=!0)if((a=r.value)&&a.name)switch(a.name){case"Good":o[0]+=1;break;case"Bad":o[1]+=1;break;default:a.name.includes("Good")?o[0]+=1:a.name.includes("Bad")?o[1]+=1:o[2]+=1}else o[2]+=1}catch(e){t=!0,d=e}finally{try{s||null==n.return||n.return()}finally{if(t)throw d}}}else o[2]+=1;return o},de.biancoroyal.opcua.iiot.core.response.defaultCompress=function(e){e.payload.hasOwnProperty("value")&&e.payload.value.hasOwnProperty("value")?e.payload=e.payload.value.value:e.payload.length&&e.payload.forEach(function(e){e.hasOwnProperty("value")&&e.value.hasOwnProperty("value")&&(e=e.value.value)}),this.trimMessageExtensions(e)},de.biancoroyal.opcua.iiot.core.response.trimMessageExtensions=function(e){delete e.nodesToRead,delete e.nodesToReadCount,delete e.addressItemsToRead,delete e.addressItemsToReadCount,delete e.addressItemsToBrowse,delete e.addressItemsToBrowseCount,delete e.addressSpaceItems,delete e.injectType,delete e.nodetype,delete e.entryStatus,delete e.entryStatusText},de.biancoroyal.opcua.iiot.core.response.trimMessagePayloadExtensions=function(e){delete e.payload.listenerParameters},de.biancoroyal.opcua.iiot.core.response.compressBrowseMessageStructure=function(e){if(e.payload.hasOwnProperty("browserResults")&&e.payload.browserResults.length){var a=[];e.payload.browserResults.forEach(function(e){a.push({nodeId:e.nodeId.toString(),browseName:e.browseName.namespaceIndex?e.browseName.namespaceIndex+":"+e.browseName.name:e.browseName,displayName:e.displayName.text})}),e.payload=a,this.trimMessageExtensions(e),this.trimMessagePayloadExtensions(e)}else this.defaultCompress(e)},de.biancoroyal.opcua.iiot.core.response.compressReadMessageStructure=function(s){switch(s.readtype){case"AllAttributes":delete s.payload.nodesToRead,delete s.resultsConverted;break;case"VariableValue":var t=[],e=s.payload,d=s.nodesToRead;s.payload.results&&(e=s.payload.results,d=s.payload.nodesToRead),e.forEach(function(e,a){if(e.hasOwnProperty("value")&&e.value.hasOwnProperty("value")){var o=null;d&&a<d.length?o=d[a]:s.addressSpaceItems&&a<s.addressSpaceItems.length&&(o=s.addressSpaceItems[a]),t.push({value:e.value.value,dataType:e.value.dataType,nodeId:o})}}),s.payload=t,delete s.nodesToRead,delete s.nodesToReadCount,delete s.addressSpaceItems}delete s.readtype,delete s.attributeId,delete s.addressItemsToRead,delete s.addressItemsToReadCount,this.trimMessageExtensions(s)},de.biancoroyal.opcua.iiot.core.response.compressWriteMessageStructure=function(o){this.defaultCompress(o);var s=[];o.payload.statusCodes.forEach(function(e,a){s.push({nodeId:o.payload.nodesToWrite?o.payload.nodesToWrite[a]:o.addressSpaceItems[a],statusCode:e,value:o.valuesToWrite?o.valuesToWrite[a]:null})}),o.payload=s,delete o.valuesToWrite},de.biancoroyal.opcua.iiot.core.response.compressListenMessageStructure=function(o){if(o.payload.hasOwnProperty("value")&&o.payload.value.hasOwnProperty("value"))o.payload={value:o.payload.value.value,dataType:o.payload.value.dataType,nodeId:o.addressSpaceItems[0].nodeId?o.addressSpaceItems[0].nodeId:o.addressSpaceItems[0]};else if(o.payload.length){var s=[];o.payload.forEach(function(e,a){e.hasOwnProperty("value")&&e.value.hasOwnProperty("value")&&s.push({value:e.value.value,dataType:e.value.dataType,nodeId:o.addressSpaceItems[a].nodeId?o.addressSpaceItems[a].nodeId:o.addressSpaceItems[a]})}),o.payload=s}this.trimMessageExtensions(o)},de.biancoroyal.opcua.iiot.core.response.compressMethodMessageStructure=function(e){this.defaultCompress(e),this.trimMessageExtensions(e),delete e.inputArguments,delete e.objectId,delete e.methodId,delete e.methodType,delete e.payload.definition},de.biancoroyal.opcua.iiot.core.response.compressDefaultMessageStructure=function(e){this.defaultCompress(e),this.trimMessageExtensions(e)},module.exports=de.biancoroyal.opcua.iiot.core.response;
//# sourceMappingURL=../maps/core/opcua-iiot-core-response.js.map
